<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Analysis Results</title>
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8fafc;
      }
      .card {
        transition: transform 0.2s ease-in-out;
      }
      .card:hover {
        transform: translateY(-2px);
      }
      .gradient-text {
        background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
    </style>
  </head>

  <body class="p-8">
    <div class="max-w-7xl mx-auto">
      <!-- Header -->
      <div class="text-center mb-12">
        <h1 class="text-4xl font-bold gradient-text mb-4">
          Data Analysis Results
        </h1>
        <p class="text-gray-600">
          Comprehensive analysis of your uploaded dataset
        </p>
      </div>

      <!-- File Information -->
      <div class="card bg-white shadow-lg mb-8 border border-gray-100">
        <div class="card-body">
          <h2 class="card-title text-2xl font-semibold mb-4 text-gray-800">
            File Information
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="flex items-center space-x-2">
              <span class="text-gray-500">Filename:</span>
              <span class="font-medium text-gray-700">{{ file.filename }}</span>
            </div>
            <div class="flex items-center space-x-2">
              <span class="text-gray-500">Total Rows:</span>
              <span class="font-medium text-gray-700"
                >{{ analysis.overview.shape.rows }}</span
              >
            </div>
            <div class="flex items-center space-x-2">
              <span class="text-gray-500">Total Columns:</span>
              <span class="font-medium text-gray-700"
                >{{ analysis.overview.shape.columns }}</span
              >
            </div>
            <div class="flex items-center space-x-2">
              <span class="text-gray-500">Duplicate Rows:</span>
              <span class="font-medium text-gray-700"
                >{{ analysis.overview.duplicate_count }}</span
              >
            </div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Column Information -->
        <div class="card bg-white shadow-lg border border-gray-100">
          <div class="card-body">
            <h2 class="card-title text-xl font-semibold mb-4 text-gray-800">
              Column Information
            </h2>
            <div class="overflow-x-auto">
              <table class="table table-zebra w-full">
                <thead>
                  <tr class="bg-gray-50">
                    <th class="text-gray-600 font-medium">Column Name</th>
                    <th class="text-gray-600 font-medium">Data Type</th>
                    <th class="text-gray-600 font-medium">Unique Values</th>
                  </tr>
                </thead>
                <tbody>
                  {% for col in analysis.overview.column_data_types %} {% set
                  unique =
                  analysis.overview.unique_values|selectattr("column_name",
                  "equalto", col.column_name)|first %}
                  <tr>
                    <td class="font-medium text-gray-700">
                      {{ col.column_name }}
                    </td>
                    <td class="text-gray-600">{{ col.data_type }}</td>
                    <td class="text-gray-600">{{ unique.unique_values }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Missing Data Analysis -->
        <div class="card bg-white shadow-lg border border-gray-100">
          <div class="card-body">
            <h2 class="card-title text-xl font-semibold mb-4 text-gray-800">
              Missing Data Analysis
            </h2>
            {% if analysis.missing_data.missing_data is string %}
            <div class="alert alert-success bg-green-50 border-green-200">
              <p class="text-green-700">
                {{ analysis.missing_data.missing_data }}
              </p>
            </div>
            {% else %}
            <div class="overflow-x-auto">
              <table class="table table-zebra w-full">
                <thead>
                  <tr class="bg-gray-50">
                    <th class="text-gray-600 font-medium">Column</th>
                    <th class="text-gray-600 font-medium">Missing Count</th>
                    <th class="text-gray-600 font-medium">Missing %</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in analysis.missing_data.missing_data %}
                  <tr>
                    <td class="font-medium text-gray-700">{{ item.column }}</td>
                    <td class="text-gray-600">{{ item.missing_count }}</td>
                    <td class="text-gray-600">
                      {{ item.missing_percentage }}%
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Descriptive Statistics -->
      {% if analysis.overview.descriptive_stats %}
      <div class="card bg-base-100 shadow-xl mt-6">
        <div class="card-body">
          <h2 class="card-title text-xl mb-4">Descriptive Statistics</h2>
          <div class="overflow-x-auto">
            <table class="table table-zebra w-full">
              <thead>
                <tr>
                  <th>Metric</th>
                  {% for column in analysis.overview.descriptive_stats.keys() %}
                  <th>{{ column }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for stat in ['count', 'mean', 'std', 'min', '25%', '50%',
                '75%', 'max'] %}
                <tr>
                  <td>{{ stat }}</td>
                  {% for column in analysis.overview.descriptive_stats.keys() %}
                  <td>
                    {{
                    analysis.overview.descriptive_stats[column][stat]|round(2)
                    if analysis.overview.descriptive_stats[column][stat] != None
                    else 'N/A' }}
                  </td>
                  {% endfor %}
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Data Preview -->
      <div class="card bg-base-100 shadow-xl mt-6">
        <div class="card-body">
          <h2 class="card-title text-xl mb-4">Data Preview (First 10 Rows)</h2>
          <div class="overflow-x-auto">
            <table class="table table-zebra w-full">
              <thead>
                <tr>
                  {% for key in analysis.overview.table_head[0].keys() %}
                  <th>{{ key }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for row in analysis.overview.table_head %}
                <tr>
                  {% for value in row.values() %}
                  <td>{{ value }}</td>
                  {% endfor %}
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="card bg-white shadow-lg mt-8 border border-gray-100">
      <div class="card-body">
        <h2 class="card-title text-2xl font-semibold mb-6 text-gray-800">
          AI Analysis Results
        </h2>

        {% if analysis.gemini_result.error %}
        <div class="alert alert-error bg-red-50 border-red-200">
          <p class="text-red-700">{{ analysis.gemini_result.error }}</p>
        </div>
        {% else %}
        <!-- Summary Section -->
        <div class="mb-8">
          <h3 class="text-xl font-semibold mb-3 text-gray-800">Summary</h3>
          <div class="bg-blue-50 p-6 rounded-lg border border-blue-100">
            <p class="text-gray-700 leading-relaxed">
              {{ analysis.gemini_result.summary }}
            </p>
          </div>
        </div>

        <!-- Issues Section -->
        <div class="mb-8">
          <h3 class="text-xl font-semibold mb-4 text-gray-800">
            Data Quality Issues
          </h3>

          <!-- Critical Issues -->
          {% if analysis.gemini_result.issues.critical %}
          <div class="mb-6">
            <h4 class="text-lg font-semibold text-red-600 mb-3">
              Critical Issues
            </h4>
            <div class="space-y-4">
              {% for issue in analysis.gemini_result.issues.critical %}
              <div class="card bg-red-50 border border-red-100">
                <div class="card-body p-5">
                  <h5 class="font-semibold text-red-800">{{ issue.column }}</h5>
                  <p class="text-gray-700 mt-2">{{ issue.issue }}</p>
                  <p class="text-gray-600 mt-2">
                    <strong class="text-red-700">Impact:</strong> {{
                    issue.impact }}
                  </p>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- Moderate Issues -->
          {% if analysis.gemini_result.issues.moderate %}
          <div class="mb-6">
            <h4 class="text-lg font-semibold text-amber-600 mb-3">
              Moderate Issues
            </h4>
            <div class="space-y-4">
              {% for issue in analysis.gemini_result.issues.moderate %}
              <div class="card bg-amber-50 border border-amber-100">
                <div class="card-body p-5">
                  <h5 class="font-semibold text-amber-800">
                    {{ issue.column }}
                  </h5>
                  <p class="text-gray-700 mt-2">{{ issue.issue }}</p>
                  <p class="text-gray-600 mt-2">
                    <strong class="text-amber-700">Impact:</strong> {{
                    issue.impact }}
                  </p>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- Minor Issues -->
          {% if analysis.gemini_result.issues.minor %}
          <div class="mb-6">
            <h4 class="text-lg font-semibold text-blue-600 mb-3">
              Minor Issues
            </h4>
            <div class="space-y-4">
              {% for issue in analysis.gemini_result.issues.minor %}
              <div class="card bg-blue-50 border border-blue-100">
                <div class="card-body p-5">
                  <h5 class="font-semibold text-blue-800">
                    {{ issue.column }}
                  </h5>
                  <p class="text-gray-700 mt-2">{{ issue.issue }}</p>
                  <p class="text-gray-600 mt-2">
                    <strong class="text-blue-700">Impact:</strong> {{
                    issue.impact }}
                  </p>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>

        <!-- Recommendations Section -->
        {% if analysis.gemini_result.recommendations %}
        <div class="mb-8">
          <h3 class="text-xl font-semibold mb-4 text-gray-800">
            Recommendations
          </h3>
          <div class="space-y-4">
            {% for rec in analysis.gemini_result.recommendations %}
            <div class="card bg-green-50 border border-green-100">
              <div class="card-body p-5">
                <p class="text-gray-700">{{ rec }}</p>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Data Quality Score -->
        {% if analysis.gemini_result.data_quality_score is defined %}
        <div class="mb-8">
          <h3 class="text-xl font-semibold mb-4 text-gray-800">
            Data Quality Score
          </h3>
          <div class="flex justify-center">
            <div
              class="radial-progress text-blue-600"
              style="--value:{{ analysis.gemini_result.data_quality_score }}; --size:14rem; --thickness: 2rem;"
            >
              {{ analysis.gemini_result.data_quality_score }}%
            </div>
          </div>
        </div>
        {% endif %} {% endif %}
      </div>
    </div>
  </body>
</html>
