<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/static/img/favicon.png">
    <title>Data Analysis Results</title>
    
     
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    
    <link rel="stylesheet" href="{{url_for( 'static', path='css/results.css')}}">
    <link rel="stylesheet" href="{{url_for( 'static', path='js/results.js')}}">
    
  </head>

  <body class="p-8">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-8">
        <div class="flex items-center justify-center mb-2">
          <i class="fas fa-chart-line text-indigo-600 text-2xl mr-2"></i>
          <h1 class="text-2xl font-semibold gradient-text">
            Data Analysis Results
          </h1>
        </div>
        <p class="text-gray-500 text-sm">
          Comprehensive analysis of your uploaded dataset
        </p>
      </div>




      <div class="card mb-6 p-6">
        <div class="flex items-center mb-4">
          <div class="section-icon">
            <i class="fas fa-file-alt"></i>
          </div>
          <h2 class="text-lg font-semibold text-gray-800">File Information</h2>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="flex items-center">
            <span class="text-gray-500 text-sm mr-2">Filename:</span>
            <span class="text-gray-800">{{ file.filename }}</span>
          </div>
          <div class="flex items-center">
            <span class="text-gray-500 text-sm mr-2">Total Rows:</span>
            <span class="text-gray-800">{{ analysis.overview.shape.rows }}</span>

          </div>
          <div class="flex items-center">
            <span class="text-gray-500 text-sm mr-2">Total Columns:</span>
            <span class="text-gray-800"
              >{{ analysis.overview.shape.columns }}</span
            >
          </div>
          <div class="flex items-center">
            <span class="text-gray-500 text-sm mr-2">Duplicate Rows:</span>
            <span class="text-gray-800"
              >{{ analysis.overview.duplicate_count }}</span
            >
          </div>
        </div>
      </div>



      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="wrappy">
        <div class="card p-6">
          <div class="flex items-center mb-4">
            <div class="section-icon">
              <i class="fas fa-table"></i>
            </div>
            <h2 class="text-lg font-semibold text-gray-800">
              Column Information
            </h2>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Column Name</th>
                  <th>Data Type</th>
                  <th>Unique Values</th>
                </tr>
              </thead>
              <tbody>
                {% for col in analysis.overview.column_data_types %} {% set
                unique =
                analysis.overview.unique_values|selectattr("column_name",
                "equalto", col.column_name)|first %}
                <tr>
                  <td>{{ col.column_name }}</td>
                  <td>{{ col.data_type }}</td>
                  <td>{{ unique.unique_values }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

        <div class="card p-6">
          <div class="flex items-center mb-4">
            <div class="section-icon">
              <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h2 class="text-lg font-semibold text-gray-800">
              Missing Data Analysis
            </h2>
          </div>
          {% if analysis.missing_data.missing_data is defined %}
          {% if analysis.missing_data.missing_data is string %}
          <div class="status-badge status-success">
            {{ analysis.missing_data.missing_data }}
          </div>
          {% else %}
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Column</th>
                  <th>Missing Count</th>
                  <th>Missing %</th>
                </tr>
              </thead>
              <tbody>
                {% for item in analysis.missing_data.missing_data %}
                <tr>
                  <td>{{ item.column }}</td>
                  <td>{{ item.missing_count }}</td>
                  <td>
                    <span
                      class="status-badge {% if item.missing_percentage > 20 %}status-error{% elif item.missing_percentage > 5 %}status-warning{% else %}status-success{% endif %}"
                    >
                      {{ item.missing_percentage }}%
                    </span>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% endif %}
          {% else %}
          <div class="status-badge status-success">
            No missing data found
          </div>
          {% endif %}
        </div>
      </div>



      

      {% if analysis.overview.descriptive_stats %}
<div class="card p-6 mt-6">
  <div class="flex items-center mb-4">
    <div class="section-icon">
      <i class="fas fa-calculator"></i>
    </div>
    <h2 class="text-lg font-semibold text-gray-800">
      Descriptive Statistics
    </h2>
  </div>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th class="font-medium sticky-col first-col">Metric</th>
          {% for column in analysis.overview.descriptive_stats.keys() %}
          <th class="font-medium">{{ column }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for stat in ['count', 'mean', 'std', 'min', '25%', '50%',
        '75%', 'max'] %}
        <tr>
          <td class="font-medium text-gray-700 sticky-col first-col">
            {% if stat == 'std' %} Standard Deviation {% elif stat ==
            'min' %} Minimum {% elif stat == 'max' %} Maximum {% elif stat
            == '25%' %} 25th Percentile {% elif stat == '50%' %} Median {%
            elif stat == '75%' %} 75th Percentile {% else %} {{ stat|title
            }} {% endif %}
          </td>
          {% for column in analysis.overview.descriptive_stats.keys() %}
          <td class="text-gray-600">
            {% set value =
            analysis.overview.descriptive_stats[column][stat] %} {% if
            value is not none %} {% if stat in ['count'] %} {{ value|int
            }} {% else %} {{ value|round(2) }} {% endif %} {% else %}
            <span class="text-gray-400">N/A</span>
            {% endif %}
          </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}


   



<div class="card p-6 mt-6">
  <div class="flex items-center mb-4">
    <div class="section-icon">
      <i class="fas fa-table"></i>
    </div>
    <h2 class="text-lg font-semibold text-gray-800">Data Preview</h2>
    <span class="ml-2 text-sm text-gray-500">(First 10 Rows)</span>
  </div>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          {% for key in analysis.overview.table_head[0].keys() %}
          <th class="font-medium" title="{{ key|title }}">{{ key|title }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in analysis.overview.table_head %}
        <tr>
          {% for value in row.values() %}
          <td class="text-gray-600">
            {% if value is none %}
              <span class="text-gray-400">N/A</span>
            {% elif value is number %}
              {% if value|round(0) == value %}
                {{ value|int }}
              {% else %}
                {{ value|round(2) }}
              {% endif %}
            {% else %}
              {{ value }}
            {% endif %}
          </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
</div>








<div class="card p-6 mt-6" id="ai_analysis_card">
  <div class="flex items-center mb-6">
    <div class="section-icon">
      <i class="fas fa-robot"></i>
    </div>
    <h2 class="text-lg font-semibold text-gray-800">
      Issues and Recommendations
    </h2>
  </div>

  {% if ai_analysis.ai_result.error %}
  <div class="status-badge status-error">
    {{ ai_analysis.error }}
  </div>
  {% else %}



  <div class="mb-8">
    <div class="flex items-center mb-3">
      <i class="fas fa-info-circle text-indigo-600 mr-2"></i>
      <h3 class="text-md font-semibold text-gray-800">Summary</h3>
    </div>
    <div class="bg-gray-50 p-4 rounded-lg">
      <p class="text-gray-700 text-sm leading-relaxed">
        {{ ai_analysis.ai_result.summary }}
      </p>
    </div>
  </div>


  <div class="mb-8">
    <div class="flex items-center mb-4">
      <i class="fas fa-exclamation-circle text-indigo-600 mr-2"></i>
      <h3 class="text-md font-semibold text-gray-800">Data Quality Issues</h3>
    </div>

    <!-- Collapsible Issue Groups -->
    <div id="issue-groups">
      <!--
        Define the groups for issue severity levels (critical, moderate, minor).
        Each tuple contains:
          (key, label, text color, background color, border color, header color, icon color, icon class, badge color)
        This is used to render collapsible sections for each issue group with appropriate styling and icons.
      -->
      {% set groups = [
        ('critical', 'Critical Issues', 'text-red-600', 'bg-red-50', 'border-red-200', 'text-red-800', 'text-red-500', 'fa-times-circle', 'status-error'),
        ('moderate', 'Moderate Issues', 'text-amber-600', 'bg-amber-50', 'border-amber-200', 'text-amber-800', 'text-amber-500', 'fa-exclamation-circle', 'status-warning'),
        ('minor', 'Minor Issues', 'text-blue-600', 'bg-blue-50', 'border-blue-200', 'text-blue-800', 'text-blue-500', 'fa-info-circle', 'status-success')
      ] %}
      {% for key, label, text_color, bg_color, border_color, head_color, icon_color, icon, badge_color in groups %}
        {% set issues = ai_analysis.ai_result.issues[key] %}
        {% if issues %}
        <div class="mb-4 border rounded-lg">
          <button type="button" class="w-full flex items-center justify-between px-4 py-3 focus:outline-none group" onclick="toggleCollapse('collapse-{{ key }}')">
            <div class="flex items-center">
              <span class="mr-2 {{ text_color }} text-lg"><i class="fas {{ icon }}"></i></span>
              <span class="font-medium {{ text_color }}">{{ label }}</span>
              <span class="ml-3 text-gray-500 text-sm">Issues that {% if key == 'critical' %}must be addressed immediately{% elif key == 'moderate' %}should be resolved soon{% else %}can be addressed when convenient{% endif %}</span>
            </div>
            <span class="ml-4 px-3 py-1 rounded-full text-white font-semibold text-sm {{ badge_color }}" style="background: {% if key == 'critical' %}#f87171{% elif key == 'moderate' %}#fbbf24{% else %}#3b82f6{% endif %};">{{ issues|length }} issues</span>
            <span class="ml-2 transition-transform group-[.open]:rotate-180"><i class="fas fa-chevron-down"></i></span>
          </button>
          <div id="collapse-{{ key }}" class="hidden px-4 pb-4">
            <div class="space-y-3 mt-2">
              {% for issue in issues %}
              <div class="bg-white p-4 rounded-lg border {{ border_color }} border-l-4 {{ text_color }} shadow-sm">
                <div class="flex items-start">
                  <span class="inline-flex items-center justify-center w-6 h-6 rounded-full mr-2 {{ bg_color }}">
                    <i class="fas {{ icon }} {{ icon_color }}"></i>
                  </span>
                  <div>
                    <h5 class="font-medium {{ head_color }} text-sm">{{ issue.column }}</h5>
                    <p class="text-gray-700 text-sm mt-1">{{ issue.issue }}</p>
                    <p class="text-gray-600 text-sm mt-1"><strong>Impact:</strong> {{ issue.impact }}</p>
                    {% if issue.recommendation %}
                    <div class="mt-4 bg-gray-50 border border-green-200 rounded-xl p-5 flex flex-col gap-3">
                      <div class="flex items-center mb-2">
                        <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-green-100 mr-2">
                          <i class="fas fa-check text-green-500"></i>
                        </span>
                        <span class="font-semibold text-green-700 text-base">Recommendation</span>
                      </div>
                      <div class="text-gray-700 text-sm mb-3">{{ issue.recommendation }}</div>
                      <!-- <div class="flex gap-3 mt-2">
                        <button type="button" class="bg-green-500 hover:bg-green-600 text-white font-semibold px-4 py-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-400 transition">Apply Fix</button>
                        <button type="button" class="bg-white border border-gray-300 hover:bg-gray-100 text-gray-700 font-semibold px-4 py-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 transition">Review Details</button>
                      </div> -->
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    <script>
      function toggleCollapse(id) {
        var el = document.getElementById(id);
        if (el.classList.contains('hidden')) {
          el.classList.remove('hidden');
        } else {
          el.classList.add('hidden');
        }
      }
    </script>
  </div>


  <!-- {% if ai_analysis.ai_result.recommendations %}
  <div class="mb-8">
    <div class="flex items-center mb-4">
      <i class="fas fa-lightbulb text-indigo-600 mr-2"></i>
      <h3 class="text-md font-semibold text-gray-800">Recommendations</h3>
    </div>
    <div class="space-y-3">
      {% for rec in ai_analysis.ai_result.recommendations %}
      <div class="bg-green-50 p-4 rounded-lg border border-green-100">
        <div class="flex items-start">
          <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
          <p class="text-gray-700 text-sm">{{ rec }}</p>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %} -->
  {% endif %}

</div>







<!-- CHAT WITH DATA SECTION  -->
<section class="max-w-7xl mx-auto mt-12 mb-16 px-4">
  <h2 class="text-2xl font-bold text-center mb-6 text-blue-700">Chat with Quiksight AI</h2>
  <div class="bg-white rounded-2xl shadow-lg p-8 flex flex-col gap-8">
    <!-- Chat history -->
    <div class="flex flex-col gap-4 max-h-96 overflow-y-auto" id="chat-history">
      
      <!-- User message (on the right) -->
      <div class="flex items-end gap-4 flex-row-reverse">
        <div class="flex-shrink-0">
          <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-lg shadow">
            <i class="fas fa-user"></i>
          </div>
        </div>
        <div>
          <div class="rounded-xl bg-blue-50 text-blue-900 px-6 py-3 shadow-sm max-w-2xl">
            Separate date column into day, month, and year
          </div>
          <div class="text-xs text-gray-400 mt-1 mr-1 text-right">You • 10:01 AM</div>
        </div>
      </div>
    </div>
    <!-- AI message (on the left) -->
    <div class="flex items-end gap-4">
      <div class="flex-shrink-0">
        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-white font-bold text-lg shadow">
          <i class="fas fa-robot"></i>
        </div>
      </div>
      <div>
        <div class="text-gray-800 px-0 py-0 max-w-2xl">
          Date column has been separated into day, month, and year.
        </div>
        <div class="text-xs text-gray-400 mt-1 ml-1">Quiksight AI • 10:01 AM</div>
      </div>
    </div>
    <!-- Chat input -->
    <form class="flex items-center gap-2 mt-2" autocomplete="off">
      <input
        type="text"
        class="flex-1 rounded-full border border-blue-200 focus:ring-2 focus:ring-blue-400 px-4 py-2 text-gray-800 bg-blue-50 placeholder-gray-400 transition"
        placeholder="Type your question..."
        id="chat-input"
        disabled
      />
      <button
        type="submit"
        class="bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-full px-5 py-2 font-semibold shadow hover:from-blue-600 hover:to-purple-600 transition"
        disabled
      >
        <i class="fas fa-paper-plane"></i>
      </button>
    </form>
    <div class="text-xs text-gray-400 text-center mt-2">Live chat coming soon!</div>
  </div>
</section>





</div>
</body>
</html>
